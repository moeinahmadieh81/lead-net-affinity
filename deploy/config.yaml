namespaceSelector: ["default"]

graph:
  entry: frontend
  services:
    - name: frontend
      dependsOn: [search, user, recommendation, reservation]

    - name: search
      dependsOn: [profile, geo, rate]

    - name: profile
      dependsOn: [memcached-profile, mongodb-profile]

    - name: geo
      dependsOn: [mongodb-geo]

    - name: rate
      dependsOn: [memcached-rate, mongodb-rate]

    - name: user
      dependsOn: [mongodb-user]

    - name: recommendation
      dependsOn: [mongodb-recommendation]

    - name: reservation
      dependsOn: [memcached-reserve, mongodb-reservation]

    - name: memcached-profile
      dependsOn: []

    - name: mongodb-profile
      dependsOn: []

    - name: mongodb-geo
      dependsOn: []

    - name: memcached-rate
      dependsOn: []

    - name: mongodb-rate
      dependsOn: []

    - name: mongodb-user
      dependsOn: []

    - name: mongodb-recommendation
      dependsOn: []

    - name: memcached-reserve
      dependsOn: []

    - name: mongodb-reservation
      dependsOn: []

prometheus:
  url: "http://prometheus-kube-prometheus-prometheus.monitoring:9090"

  NodeRTTQuery: |
    histogram_quantile(
      0.5,
      sum(
        rate(cilium_node_health_connectivity_latency_seconds_bucket[10m])
      ) by (instance, le)
    )

  NodeDropRateQuery: |
    sum(
      rate(cilium_drop_bytes_total[10m])
    ) by (instance)

  NodeBandwidthQuery: |
    sum(
      rate(cilium_forward_bytes_total[10m])
    ) by (instance)

  sampleWindow: "10m"

scoring:
  # Base weights
  pathLengthWeight: 1
  podCountWeight: 0.5
  serviceEdgesWeight: 1
  rpsWeight: 2

  # ⚖️ BALANCED: Less strict thresholds
  badLatencyMs: 70        # ⬆️ Was 60 - more lenient
  badDropRate: 30         # ⬆️ Was 20 - more lenient
  badBandwidthRate: 75000 # ⬆️ Was 50000 - more lenient

  # ⚖️ BALANCED: Moderate network penalties
  netLatencyWeight: 6     # ⬇️ Was 8 - less aggressive
  netDropWeight: 12       # ⬇️ Was 20 - much less aggressive
  netBandwidthWeight: 2   # ⬇️ Was 3 - less aggressive

affinity:
  topPaths:           5
  minAffinityWeight:  50
  maxAffinityWeight:  100

rebalancing:
  enabled: true
  minPodAgeSeconds: 30    # Don't delete pods younger than 30 seconds
  maxConcurrentDeletions: 3
